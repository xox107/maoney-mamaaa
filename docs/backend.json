{
  "entities": {
    "UserAccount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserAccount",
      "type": "object",
      "description": "Stores user account information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user account."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents an income entry.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the income entry."
        },
        "userAccountId": {
          "type": "string",
          "description": "Reference to UserAccount. (Relationship: UserAccount 1:N Income)"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the income."
        },
        "category": {
          "type": "string",
          "description": "The category of the income (e.g., Salary, Investments)."
        },
        "note": {
          "type": "string",
          "description": "Optional note for the income entry."
        },
        "pendingPayment": {
          "type": "boolean",
          "description": "Indicates if the income is a pending payment."
        },
        "date": {
          "type": "string",
          "description": "The date of the income entry.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userAccountId",
        "amount",
        "category",
        "date"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense entry.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense entry."
        },
        "userAccountId": {
          "type": "string",
          "description": "Reference to UserAccount. (Relationship: UserAccount 1:N Expense)"
        },
        "date": {
          "type": "string",
          "description": "The date of the expense entry.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the expense."
        },
        "category": {
          "type": "string",
          "description": "The category of the expense (e.g., Groceries, Rent)."
        },
        "note": {
          "type": "string",
          "description": "Optional note for the expense entry."
        }
      },
      "required": [
        "id",
        "userAccountId",
        "date",
        "amount",
        "category"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userAccountId}",
        "definition": {
          "entityName": "UserAccount",
          "schema": {
            "$ref": "#/backend/entities/UserAccount"
          },
          "description": "Stores user account information.  This top-level collection is primarily for storing user profile data, if needed, and for scoping user-specific data.",
          "params": [
            {
              "name": "userAccountId",
              "description": "The unique identifier for the user account, corresponding to the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userAccountId}/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": {
            "$ref": "#/backend/entities/Income"
          },
          "description": "Stores income entries for a specific user.  The 'userAccountId' path parameter ensures that each user can only access their own income data.",
          "params": [
            {
              "name": "userAccountId",
              "description": "The unique identifier for the user account, corresponding to the Firebase Auth UID.  This enforces ownership."
            },
            {
              "name": "incomeId",
              "description": "The unique identifier for the income entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userAccountId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense entries for a specific user. The 'userAccountId' path parameter ensures that each user can only access their own expense data.",
          "params": [
            {
              "name": "userAccountId",
              "description": "The unique identifier for the user account, corresponding to the Firebase Auth UID. This enforces ownership."
            },
            {
              "name": "expenseId",
              "description": "The unique identifier for the expense entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure secure and efficient data management for the MONEY MAMAA application, adhering to the principles of Authorization Independence, Structural Segregation, and Access Modeling.  Each user has their own dedicated space for income and expense data, simplifying security rules and ensuring data privacy.\n\nAuthorization Independence is achieved by storing all income and expense documents under a user-specific path. Access control relies solely on the `request.auth.uid`, eliminating the need for `get()` calls in security rules. This enables atomic operations (transactions/batches) and simplifies debugging.\n\nStructural Segregation: The structure ensures that all documents within a collection share the same security requirements. All incomes and expenses for a specific user are stored under that user's ID, ensuring consistent access control.\n\nQAPs (Rules are not Filters) is supported through path-based ownership. List operations are secure because data is segregated by user, and security rules can easily validate that the authenticated user is accessing their own data.\n"
  }
}